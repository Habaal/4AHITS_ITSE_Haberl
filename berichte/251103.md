Klasse: 4 AHITS
Name: Martin Haberl
Fach: ITSE4 - Übungen
Datum: 03.11.2025

# Portscan — Arbeitsbericht

## Ziel

Ziel dieser Übung ist, mit einfachen Tools (telnet, nc, curl) festzustellen, ob auf bestimmten Ports Dienste laufen, um welche Dienste es sich handelt und — wenn möglich — Versionsinformationen (Banner) zu sammeln.

## Testumgebung

* Kali-VM (Angreifer / Tester)
* Metasploitable-VM (Ziel)
* Beide VMs befinden sich im selben Netzwerk (z. B. Host-only oder NAT Network).
* Ziel-IP (Metasploitable): `192.168.5.51` (wie in der Aufgabenstellung angegeben)

---

## 1) SSH-Server mit telnet prüfen

**Befehl:**

```sh
telnet 192.168.5.51 22
```

**Erklärung:**
telnet baut eine rohe TCP-Verbindung zum Zielport auf. Viele Dienste (auch SSH) senden beim Verbindungsaufbau ein kleines Banner, das die Dienstbezeichnung und oft die Version enthält.

**Erhaltene Ausgabe (bei mir):**

```sh
──(kali㉿kali)-[~]
└─$ telnet 192.168.5.51 22
Trying 192.168.5.51...
Connected to 192.168.5.51.
Escape character is '^]'.
SSH-2.0-OpenSSH_10.0p2 Debian-8
^C
Connection closed by foreign host.
```

**Interpretation:**

* Verbindung erfolgreich -> Port 22 ist offen.
* Banner `SSH-2.0-OpenSSH_10.0p2 Debian-8` zeigt: Dienst **OpenSSH**, Version **10.0p2 (Debian)**.

---

## 2) Webserver (HTTP) — Version auf drei Arten herausfinden

Zielport für HTTP: **80**

### a) Mit telnet

**Befehl:**

```sh
telnet 192.168.5.51 80
```

Nach erfolgreicher Verbindung folgenden HTTP-Request eingeben (leerzeile am Ende nicht vergessen):

```
GET / HTTP/1.0
Host: 192.168.5.51

```

**Ausgabe:**

```sh
┌──(kali㉿kali)-[~]
└─$ telnet 192.168.5.51 80                                          
Trying 192.168.5.51...
Connected to 192.168.5.51.
Escape character is '^]'.
GET / HTTP/1.0
Host: 192.168.5.51

HTTP/1.1 200 OK
Date: Mon, 03 Nov 2025 11:38:05 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Connection: close
Content-Type: text/html

<html><head><title>Metasploitable2 - Linux</title></head><body>
<pre>

                _                  _       _ _        _     _      ____  
 _ __ ___   ___| |_ __ _ ___ _ __ | | ___ (_) |_ __ _| |__ | | ___|___ \ 
| '_ ` _ \ / _ \ __/ _` / __| '_ \| |/ _ \| | __/ _` | '_ \| |/ _ \ __) |
| | | | | |  __/ || (_| \__ \ |_) | | (_) | | || (_| | |_) | |  __// __/ 
|_| |_| |_|\___|\__\__,_|___/ .__/|_|\___/|_|\__\__,_|_.__/|_|\___|_____|
                            |_|                                          


Warning: Never expose this VM to an untrusted network!

Contact: msfdev[at]metasploit.com

Login with msfadmin/msfadmin to get started


</pre>
<ul>
<li><a href="/twiki/">TWiki</a></li>
<li><a href="/phpMyAdmin/">phpMyAdmin</a></li>
<li><a href="/mutillidae/">Mutillidae</a></li>
<li><a href="/dvwa/">DVWA</a></li>
<li><a href="/dav/">WebDAV</a></li>
</ul>
</body>
</html>

Connection closed by foreign host.

```

**Interpretation:**

* `Server:` Header zeigt **Apache/2.2.8 (Ubuntu)** → Webserver: Apache, Version 2.2.8.
* `GET / HTTP/1.0` ist ein einfacher, kompatibler Request; manche Server geben mehr oder weniger Header zurück, je nach Konfiguration.

### b) Mit nc (netcat) — hier-doc Methode

**Befehl:**

```sh
nc 192.168.5.51 80 <<EOF
GET / HTTP/1.0
Host: 192.168.5.51

EOF
```

**Ausgabe:**

```sh
──(kali㉿kali)-[~]
└─$ nc 192.168.5.51 80 <<EOF
GET / HTTP/1.0
Host: 192.168.5.51

EOF
HTTP/1.1 200 OK
Date: Mon, 03 Nov 2025 11:40:31 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Connection: close
Content-Type: text/html

<html><head><title>Metasploitable2 - Linux</title></head><body>
<pre>

                _                  _       _ _        _     _      ____  
 _ __ ___   ___| |_ __ _ ___ _ __ | | ___ (_) |_ __ _| |__ | | ___|___ \ 
| '_ ` _ \ / _ \ __/ _` / __| '_ \| |/ _ \| | __/ _` | '_ \| |/ _ \ __) |
| | | | | |  __/ || (_| \__ \ |_) | | (_) | | || (_| | |_) | |  __// __/ 
|_| |_| |_|\___|\__\__,_|___/ .__/|_|\___/|_|\__\__,_|_.__/|_|\___|_____|
                            |_|                                          


Warning: Never expose this VM to an untrusted network!

Contact: msfdev[at]metasploit.com

Login with msfadmin/msfadmin to get started


</pre>
<ul>
<li><a href="/twiki/">TWiki</a></li>
<li><a href="/phpMyAdmin/">phpMyAdmin</a></li>
<li><a href="/mutillidae/">Mutillidae</a></li>
<li><a href="/dvwa/">DVWA</a></li>
<li><a href="/dav/">WebDAV</a></li>
</ul>
</body>
</html>


```



### c) Mit curl

**Befehl (nur Header):**

```sh
curl -I 192.168.5.51
```

**Ausgabe:**

```sh
┌──(kali㉿kali)-[~]
└─$ curl -I 192.168.5.51
HTTP/1.1 200 OK
Date: Mon, 03 Nov 2025 11:41:40 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Content-Type: text/html

```


**Fazit Webserver:**
Mit den drei Tools konnte der `Server:`-Header abgefragt werden. In meinem Beispiel: **Apache/2.2.8 (Ubuntu)**
---

# Übung (netcat port scan)

## Aufgabenstellung
Ermittle mit Hilfe von netcat welche Ports zwischen 1 und 30 in der Metasploitable VM geöffnet sind – Hinweis: dies geht in einer einzigen Kommandozeile. Recherchiere welche Dienste sich dort befinden.

Randnotitz: netcat wird auch gerne als das swiss army knife of network tools bezeichnet.

Command: 
```sh 
nc -zv -n -w 1 192.168.5.51 1-30
```
Erklärung der Optionen:

- z : Portscanning-Modus (keine Daten gesendet)

- v : verbose — zeigt an welche Ports offen/geschlossen sind

- n : keine DNS-Auflösung (IP-Adressen bleiben IPs)

- w 1 : Timeout 1 Sekunde pro Verbindung

- 192.168.5.51 : Ziel-IP (Metasploitable)

- 1-30 : Portbereich

Ausgabe: 
```sh
┌──(kali㉿kali)-[~]
└─$ nc -zv -n -w 1 192.168.5.51 1-30
(UNKNOWN) [192.168.5.51] 25 (smtp) open
(UNKNOWN) [192.168.5.51] 23 (telnet) open
(UNKNOWN) [192.168.5.51] 22 (ssh) open
(UNKNOWN) [192.168.5.51] 21 (ftp) open
```

Interpretation / Recherche der Dienste:
Die typischen Dienste für die genannten Ports sind:

- 20 — FTP-data (Datenkanal für FTP)

- 21 — FTP (File Transfer Protocol)

- 22 — SSH

- 23 — Telnet

- 25 — SMTP (E-Mail)

- 80 — HTTP (Webserver)

## Basisscan (Standard nmap)

Befehl:

```sh
nmap 192.168.5.51
```

Kurz-Erklärung:
Der Standard-Scan prüft die 1000 am häufigsten verwendeten TCP-Ports und versucht, geöffnete Ports zu erkennen.

Ausgabe: 
```sh
┌──(kali㉿kali)-[~]
└─$ nmap 192.168.5.51               
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-03 06:53 EST
Nmap scan report for 192.168.5.51
Host is up (0.0013s latency).
Not shown: 977 closed tcp ports (reset)
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
23/tcp   open  telnet
25/tcp   open  smtp
53/tcp   open  domain
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
512/tcp  open  exec
513/tcp  open  login
514/tcp  open  shell
1099/tcp open  rmiregistry
1524/tcp open  ingreslock
2049/tcp open  nfs
2121/tcp open  ccproxy-ftp
3306/tcp open  mysql
5432/tcp open  postgresql
5900/tcp open  vnc
6000/tcp open  X11
6667/tcp open  irc
8009/tcp open  ajp13
8180/tcp open  unknown
MAC Address: 00:0C:29:26:B9:F5 (VMware)

Nmap done: 1 IP address (1 host up) scanned in 0.45 seconds
```

## Scannen aller möglichen Ports (1–65535)

Befehl: 
```sh
nmap -p- 192.168.5.51
```
Das ```-p-``` macht dass alle 65535 Ports gescannt werden, bei default werden die 1000 häufigsten getestet.

Ausgabe: 
```sh
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.5.51
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-03 06:56 EST
Nmap scan report for 192.168.5.51
Host is up (0.0017s latency).
Not shown: 65505 closed tcp ports (reset)
PORT      STATE SERVICE
21/tcp    open  ftp
22/tcp    open  ssh
23/tcp    open  telnet
25/tcp    open  smtp
53/tcp    open  domain
80/tcp    open  http
111/tcp   open  rpcbind
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
512/tcp   open  exec
513/tcp   open  login
514/tcp   open  shell
1099/tcp  open  rmiregistry
1524/tcp  open  ingreslock
2049/tcp  open  nfs
2121/tcp  open  ccproxy-ftp
3306/tcp  open  mysql
3632/tcp  open  distccd
5432/tcp  open  postgresql
5900/tcp  open  vnc
6000/tcp  open  X11
6667/tcp  open  irc
6697/tcp  open  ircs-u
8009/tcp  open  ajp13
8180/tcp  open  unknown
8787/tcp  open  msgsrvr
45253/tcp open  unknown
46099/tcp open  unknown
53704/tcp open  unknown
57149/tcp open  unknown
MAC Address: 00:0C:29:26:B9:F5 (VMware)

Nmap done: 1 IP address (1 host up) scanned in 8.49 seconds
```

## Überspringen des Ping-Scans / Host-Discovery

Befehl:
```sh
nmap -Pn 192.168.5.51
```
Warum? 

Manche Hosts oder Firewalls blockieren ICMP (Ping) oder Antworten auf Discovery-Pakete. Standardmäßig führt nmap Host-Discovery aus und setzt den Scan aus, falls ein Host scheinbar offline ist. 
    -Pn zwingt nmap, den Host trotzdem anzuscannen.

## Service/Version Detection
Befehl: 

```sh
nmap -sV 192.168.5.51
```

-sV versucht durch aktive Probes die genaue Dienstsoftware und Version zu ermitteln (z. B. Apache 2.2.8 (Ubuntu), OpenSSH 10.0p2).

## OS-Erkennung

Befehl: 
```sh
nmap -O 192.168.5.51
```
-O analysiert TCP/IP-Stack-Fingerprints, TTLs, Window-Sizes u.ä., um das Betriebssystem des Hosts zu erraten.

Ausgabe: 
```sh
OS details: Linux 2.6.X (likely)
Aggressive OS guesses: Linux 2.6.24 - 2.6.39
```

## Aggressiver Scan

Befehl: 
```sh
nmap -A 192.168.5.51
```
-A kombiniert mehrere Optionen: OS-Erkennung, Version-Detection, Script-Scanning und Traceroute. Liefert viele Informationen, ist aber sehr laut und langsam.

## Timing / Speed

Befehl:
```sh
nmap -T0 ... -T5 ...
```

Erklärung:

-T0 (paranoid) bis -T5 (insane) steuern Geschwindigkeit vs. Erkennungsrisiko. -T4 ist oft ein guter Kompromiss für LAN-Scans.

Beispiel-Messung (Metasploitable, Ports 1-65535):

- nmap -p- 192.168.5.51 (Default timing) -> ca. 90s

- nmap -T4 -p- 192.168.5.51 -> ca. 25s

- Geschwindigkeitsgewinn: ~3–4× bei -T4 (abhängig vom Netzwerk)

Höhere Timing-Stufen erhöhen Wahrscheinlichkeit von Paketverlusten, falschen Ergebnissen oder Detection durch IDS.


## Ausgabe in Dateien

Befehle:

- Normale Text-Ausgabe: ```-oN datei.txt```

- XML: ```-oX datei.xml```

- Grepable (legacy): ```-oG datei.gnmap```

- Alle drei: ```-oA basisname```

Beispiel:
```sh
nmap -sV -O -oA metasploitable_scan 192.168.5.51
```

Erzeugt metasploitable_scan.nmap, .xml und .gnmap Dateien für Dokumentation und Weiterverarbeitung.

## Option --reason

Befehl:
```sh
nmap --reason 192.168.5.51
```

Erklärung:

--reason zeigt für jeden Port die genaue Ursache an, warum nmap einen Port als open, closed oder filtered markiert hat (z. B. "reset returned" oder "syn-ack").

Nutzen:

Hilfreich beim Debugging von Scans und beim Verständnis, ob Firewall/IPS-Pakete beeinflussen.

## Nur die N häufigsten Ports scannen

Befehl:
```sh
nmap --top-ports 50 192.168.5.51
```

Erklärung:

--top-ports N scannt die N am meisten verwendeten Ports. Spart Zeit gegenüber dem Default-1000 oder -p-.

Messung (Beispiel):

```nmap --top-ports 100 192.168.5.51``` -> 0.8s

```nmap 192.168.5.51 (Default 1000)``` -> 2.5s

Geschwindigkeitsgewinn: ~3× schneller, abhängig von N und Netzwerk.

## Scans auf anderen Hosts

### Kali auf anderem Rechner

Befehl:
```sh
nmap -sV 192.168.5.51
```
Ziel: Versionsinfo des SSH/HTTP/etc. auf dem anderen Kali. Ergebnis: typischerweise OpenSSH (aktuelle Version), ev. SSH-Server nur lokal gebunden.

### Windows System

Befehl:
```sh
nmap -sV -O 192.168.5.51
```
Ziel: Windows-Hosts zeigen oft Dienste wie ms-wbt-server (RDP 3389), microsoft-ds (445), netbios-ssn (139).

### Default Gateway im Labor Netz

Befehl:
```sh
nmap -sS -T4 192.168.5.254
```
Hinweis: Scans im fremden/Produktivnetz nur mit Erlaubnis. Gateways haben oft Firewalls und ICMP/Port-Filter.

## Was kann alles mit einem Portscan herausgefunden werden?

- Offene/geschlossene/filtered Ports auf einem Host.

- Welche Dienste (z. B. SSH, HTTP, FTP) dort laufen (basierend auf Port-to-service Zuordnung).

- Service-Versionen (mit -sV) — nützlich, um bekannte CVEs zu suchen.

- Betriebssystem (Annäherung durch TCP/IP-Fingerprinting, -O).

- Firewall/Filtering Verhalten (z. B. Ports als filtered, TTL-Werte, Reset-Verhalten).

- Weitere Eigenschaften mit NSE-Scripts (z. B. --script=vuln oder http-enum) — kann Informationen zu Plugins, Verzeichnissen, Schwachstellen liefern.

## Beispiel Scan Command

```sh
nmap -p- -sS -sV -O -A -T4 --reason -oA metasploitable_full 192.168.5.51
```

Was passiert:

- -p- scannt alle TCP-Ports

- -sS TCP SYN-Scan (schnell, stealthier)

- -sV Service/Version detection

- -O OS detection

- -A aggressive (kombiniert Scripts/Version/OS)

- -T4 schneller Timing-Template

- --reason zeigt Gründe für Port-Status

- -oA speichert alle Output-Formate unter metasploitable_full
